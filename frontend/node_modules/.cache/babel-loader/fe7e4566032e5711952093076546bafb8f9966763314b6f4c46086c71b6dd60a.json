{"ast":null,"code":"var _jsxFileName = \"D:\\\\Usuarios\\\\FRANCO\\\\Desktop\\\\parroquav3\\\\frontend\\\\src\\\\contexts\\\\AuthContext.js\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport React, { createContext, useContext, useEffect, useState, useRef, useMemo, useCallback } from 'react';\nimport { useTheme } from './ThemeContext';\nimport { createPortal } from 'react-dom';\nimport { Fragment as _Fragment, jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst AuthContext = /*#__PURE__*/createContext();\n// Evita re-render de la app cuando el Provider cambia estado interno no relevante\nconst ChildrenContainer = /*#__PURE__*/React.memo(_c = ({\n  children\n}) => /*#__PURE__*/_jsxDEV(_Fragment, {\n  children: children\n}, void 0, false));\n_c2 = ChildrenContainer;\nexport const useAuth = () => {\n  _s();\n  return useContext(AuthContext);\n};\n_s(useAuth, \"gDsCjeeItUuvgOWf1v4qoK9RF6k=\");\nexport const AuthProvider = ({\n  children\n}) => {\n  _s2();\n  const [user, setUser] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const [sessionExpiring, setSessionExpiring] = useState(false);\n  const {\n    setTheme\n  } = useTheme();\n\n  // ‚öôÔ∏è CONFIGURACI√ìN DE TIEMPOS (m√°s legible)\n  // Formato: { minutos: X, segundos: Y }\n  const TIEMPO_CONFIG = {\n    TOKEN_DURACION: {\n      minutos: 1,\n      segundos: 0\n    },\n    // Igual que backend\n    REFRESH_ANTICIPADO: {\n      minutos: 0,\n      segundos: 10\n    },\n    // 10s antes de expirar\n    AVISO_INACTIVIDAD: {\n      minutos: 0,\n      segundos: 45\n    },\n    // Aviso a los 45s\n    LOGOUT_INACTIVIDAD: {\n      minutos: 1,\n      segundos: 0\n    } // Logout a 1 min\n  };\n\n  // üîß Funci√≥n helper para convertir a milisegundos\n  const aMs = config => (config.minutos * 60 + config.segundos) * 1000;\n\n  // Constantes calculadas (NO MODIFICAR)\n  const ACCESS_TOKEN_LIFETIME = aMs(TIEMPO_CONFIG.TOKEN_DURACION);\n  const REFRESH_BEFORE_EXPIRY = aMs(TIEMPO_CONFIG.REFRESH_ANTICIPADO);\n  const INACTIVITY_WARNING = aMs(TIEMPO_CONFIG.AVISO_INACTIVIDAD);\n  const INACTIVITY_TIMEOUT = aMs(TIEMPO_CONFIG.LOGOUT_INACTIVIDAD);\n  const COUNTDOWN_SECONDS = Math.floor((INACTIVITY_TIMEOUT - INACTIVITY_WARNING) / 1000);\n  const [countdown, setCountdown] = useState(COUNTDOWN_SECONDS);\n\n  // üîí REFS para control de estado y prevenci√≥n de race conditions\n  const countdownRef = useRef(null);\n  const inactivityTimerRef = useRef(null);\n  const totalSessionTimerRef = useRef(null);\n  const sessionExpiringRef = useRef(sessionExpiring);\n  const refreshTimerRef = useRef(null);\n  const isRefreshingRef = useRef(false);\n  const refreshPromiseRef = useRef(null);\n  const tokenExpiryTimeRef = useRef(null);\n  const lastActivityTimeRef = useRef(0);\n  const didInitRef = useRef(false);\n  useEffect(() => {\n    sessionExpiringRef.current = sessionExpiring;\n  }, [sessionExpiring]);\n\n  // ========================\n  // üü¢ Inicializaci√≥n de sesi√≥n (con guardia StrictMode + cache perfil)\n  // ========================\n  useEffect(() => {\n    if (!window.__profileCache) window.__profileCache = {\n      value: null,\n      expiry: 0\n    };\n    if (!window.__profileInFlight) window.__profileInFlight = null;\n    const initializeAuth = async () => {\n      const savedUser = localStorage.getItem('user');\n      const accessToken = localStorage.getItem('access_token');\n      if (savedUser && accessToken) {\n        try {\n          var _parsed$preferences;\n          const parsed = JSON.parse(savedUser);\n          setUser(parsed);\n          // Aplica tema desde preferencias guardadas del usuario (si existen)\n          if (parsed !== null && parsed !== void 0 && (_parsed$preferences = parsed.preferences) !== null && _parsed$preferences !== void 0 && _parsed$preferences.theme) {\n            setTheme(parsed.preferences.theme);\n          } else if (parsed !== null && parsed !== void 0 && parsed.id) {\n            // Si no hay preferencia en backend, usar la guardada por usuario en local\n            const perUser = localStorage.getItem(`app-theme-${parsed.id}`);\n            if (perUser) setTheme(perUser);\n          }\n        } catch {}\n\n        // Establecer tiempo de expiraci√≥n del token\n        const tokenExpiry = localStorage.getItem('token_expiry');\n        if (tokenExpiry) {\n          tokenExpiryTimeRef.current = parseInt(tokenExpiry);\n          scheduleTokenRefresh();\n        }\n        try {\n          const now = Date.now();\n          const cache = window.__profileCache;\n          if (cache.value && cache.expiry > now) {\n            var _perfil$preferences;\n            const perfil = cache.value;\n            setUser(perfil);\n            localStorage.setItem('user', JSON.stringify(perfil));\n            if (perfil !== null && perfil !== void 0 && (_perfil$preferences = perfil.preferences) !== null && _perfil$preferences !== void 0 && _perfil$preferences.theme) {\n              setTheme(perfil.preferences.theme);\n            } else if (perfil !== null && perfil !== void 0 && perfil.id) {\n              const perUser = localStorage.getItem(`app-theme-${perfil.id}`);\n              if (perUser) setTheme(perUser);\n            }\n          } else {\n            if (window.__profileInFlight) {\n              await window.__profileInFlight; // esperar a la petici√≥n en curso\n            } else {\n              window.__profileInFlight = (async () => {\n                const response = await fetch('http://localhost:5000/api/users/profile', {\n                  method: 'GET',\n                  headers: {\n                    'Authorization': `Bearer ${accessToken}`\n                  }\n                });\n                if (!response.ok) {\n                  await refreshToken();\n                } else {\n                  const data = await response.json();\n                  const perfil = (data === null || data === void 0 ? void 0 : data.user) || data;\n                  if (perfil) {\n                    window.__profileCache = {\n                      value: perfil,\n                      expiry: Date.now() + 60000\n                    };\n                  }\n                }\n              })();\n              try {\n                await window.__profileInFlight;\n              } finally {\n                window.__profileInFlight = null;\n              }\n            }\n            // aplicar desde cache si se llen√≥\n            if (window.__profileCache.value) {\n              var _perfil$preferences2;\n              const perfil = window.__profileCache.value;\n              setUser(perfil);\n              localStorage.setItem('user', JSON.stringify(perfil));\n              if (perfil !== null && perfil !== void 0 && (_perfil$preferences2 = perfil.preferences) !== null && _perfil$preferences2 !== void 0 && _perfil$preferences2.theme) {\n                setTheme(perfil.preferences.theme);\n              } else if (perfil !== null && perfil !== void 0 && perfil.id) {\n                const perUser = localStorage.getItem(`app-theme-${perfil.id}`);\n                if (perUser) setTheme(perUser);\n              }\n            }\n          }\n        } catch (error) {\n          console.error('Error verificando token:', error);\n          await logout();\n        }\n      }\n      setLoading(false);\n    };\n    if (didInitRef.current) return;\n    didInitRef.current = true;\n    initializeAuth();\n  }, []);\n\n  // ========================\n  // üîÅ Sincronizar logout entre pesta√±as\n  // ========================\n  useEffect(() => {\n    const syncLogout = e => {\n      if (e.key === 'logout_event') {\n        setUser(null);\n        localStorage.removeItem('user');\n        localStorage.removeItem('access_token');\n        localStorage.removeItem('refresh_token');\n        localStorage.removeItem('token_expiry');\n        // NO usar navigate aqu√≠, ProtectedRoutes lo manejar√°\n      }\n    };\n    window.addEventListener('storage', syncLogout);\n    return () => window.removeEventListener('storage', syncLogout);\n  }, []);\n\n  // ========================\n  // üîÑ REFRESH PROACTIVO (antes de que expire)\n  // ========================\n  const scheduleTokenRefresh = () => {\n    // Limpiar timer anterior\n    if (refreshTimerRef.current) {\n      clearTimeout(refreshTimerRef.current);\n    }\n    const expiryTime = tokenExpiryTimeRef.current;\n    if (!expiryTime) return;\n    const now = Date.now();\n    const timeUntilExpiry = expiryTime - now;\n    const timeUntilRefresh = timeUntilExpiry - REFRESH_BEFORE_EXPIRY;\n    console.log(`üïê Token expira en: ${Math.round(timeUntilExpiry / 1000)}s`);\n    console.log(`üîÑ Programando refresh en: ${Math.round(timeUntilRefresh / 1000)}s`);\n\n    // Solo programar refresh si tiene sentido (token a√∫n v√°lido y no cerca de expirar)\n    if (timeUntilRefresh > 0 && timeUntilExpiry > 0) {\n      refreshTimerRef.current = setTimeout(async () => {\n        console.log('üîÑ Ejecutando refresh proactivo...');\n        const success = await refreshToken();\n\n        // Si el refresh falla, no programar otro (evita loop infinito)\n        if (!success) {\n          console.log('‚ùå Refresh fall√≥, no se programa otro');\n        }\n      }, timeUntilRefresh);\n    } else if (timeUntilExpiry > 0 && timeUntilExpiry <= REFRESH_BEFORE_EXPIRY) {\n      // Token est√° muy cerca de expirar, refresh inmediato\n      console.log('‚ö†Ô∏è Token muy cerca de expirar, refresh inmediato');\n      refreshToken();\n    } else {\n      // Token ya expir√≥\n      console.log('‚ö†Ô∏è Token ya expir√≥');\n    }\n  };\n\n  // ========================\n  // üîí REFRESH CON LOCK (evita m√∫ltiples llamadas simult√°neas)\n  // ========================\n  const refreshToken = async () => {\n    // Si ya hay un refresh en progreso, esperar a que termine\n    if (isRefreshingRef.current && refreshPromiseRef.current) {\n      console.log('‚è≥ Refresh en progreso, esperando...');\n      return refreshPromiseRef.current;\n    }\n\n    // Marcar que estamos haciendo refresh\n    isRefreshingRef.current = true;\n    refreshPromiseRef.current = (async () => {\n      try {\n        const refreshToken = localStorage.getItem('refresh_token');\n        if (!refreshToken) {\n          console.log('‚ùå No hay refresh token');\n          await logout();\n          return false;\n        }\n        console.log('üîÑ Ejecutando refresh token...');\n        const response = await fetch('http://localhost:5000/api/auth/refresh', {\n          method: 'POST',\n          headers: {\n            'Authorization': `Bearer ${refreshToken}`\n          }\n        });\n        const data = await response.json();\n        if (response.ok) {\n          console.log('‚úÖ Refresh exitoso');\n\n          // Guardar nuevos tokens\n          localStorage.setItem('access_token', data.access_token);\n          if (data.refresh_token) {\n            localStorage.setItem('refresh_token', data.refresh_token);\n          }\n\n          // Calcular y guardar tiempo de expiraci√≥n\n          const expiryTime = Date.now() + ACCESS_TOKEN_LIFETIME;\n          localStorage.setItem('token_expiry', expiryTime.toString());\n          tokenExpiryTimeRef.current = expiryTime;\n          if (data.user) {\n            // Evitar reiniciar timers por cambios de referencia del usuario durante refresh\n            if (!user) {\n              setUser(data.user);\n              localStorage.setItem('user', JSON.stringify(data.user));\n            }\n          }\n\n          // ‚úÖ CR√çTICO: Solo programar pr√≥ximo refresh si NO es un refresh proactivo repetitivo\n          // El pr√≥ximo refresh se programar√° solo cuando sea necesario (por authFetch o nuevo login)\n          console.log('‚úÖ Token renovado, NO se programa refresh autom√°tico adicional');\n          return true;\n        } else {\n          console.log('‚ùå Refresh fall√≥:', data.error);\n          await logout();\n          return false;\n        }\n      } catch (error) {\n        console.error('‚ùå Error en refresh:', error);\n        await logout();\n        return false;\n      } finally {\n        // Liberar el lock\n        isRefreshingRef.current = false;\n        refreshPromiseRef.current = null;\n      }\n    })();\n    return refreshPromiseRef.current;\n  };\n\n  // ========================\n  // ‚è∞ Control de inactividad (SEPARADO del refresh de token)\n  // ========================\n  useEffect(() => {\n    if (!user) return;\n    const resetInactivityTimers = () => {\n      // NO resetear si el modal ya est√° visible\n      if (sessionExpiringRef.current) return;\n      clearTimeout(inactivityTimerRef.current);\n      clearTimeout(totalSessionTimerRef.current);\n      clearInterval(countdownRef.current);\n      setSessionExpiring(false);\n      setCountdown(COUNTDOWN_SECONDS);\n      console.log('üîÑ Reset timers de inactividad', new Date().toLocaleTimeString());\n\n      // Timer para mostrar aviso\n      inactivityTimerRef.current = setTimeout(() => {\n        console.log('‚è≥ Mostrando aviso de inactividad');\n        setSessionExpiring(true);\n        // No iniciar conteo visual para evitar re-renders constantes\n      }, INACTIVITY_WARNING);\n\n      // Timer para logout autom√°tico\n      totalSessionTimerRef.current = setTimeout(() => {\n        console.log('üö™ Timeout alcanzado, cerrando sesi√≥n');\n        handleAutoLogout();\n      }, INACTIVITY_TIMEOUT);\n    };\n    const startCountdown = () => {\n      // Eliminado conteo visual para evitar re-render de toda la app\n      // El cierre autom√°tico lo maneja totalSessionTimerRef\n      clearInterval(countdownRef.current);\n    };\n    const handleAutoLogout = async () => {\n      console.log('üö™ Logout autom√°tico por inactividad');\n      clearInterval(countdownRef.current);\n      setSessionExpiring(false);\n      await logout();\n    };\n    const handleUserActivity = () => {\n      // Si el modal est√° visible, NO resetear\n      if (sessionExpiringRef.current) {\n        console.log('‚ö†Ô∏è Modal visible, ignorando actividad');\n        return;\n      }\n      // Throttle de eventos de actividad para evitar r√°fagas (mousemove/scroll)\n      const now = Date.now();\n      if (now - lastActivityTimeRef.current < 1000) return;\n      lastActivityTimeRef.current = now;\n      resetInactivityTimers();\n    };\n\n    // Suscribir eventos de actividad\n    window.addEventListener('mousemove', handleUserActivity);\n    window.addEventListener('keydown', handleUserActivity);\n    window.addEventListener('scroll', handleUserActivity);\n    window.addEventListener('click', handleUserActivity);\n\n    // Inicializar timers\n    resetInactivityTimers();\n    return () => {\n      window.removeEventListener('mousemove', handleUserActivity);\n      window.removeEventListener('keydown', handleUserActivity);\n      window.removeEventListener('scroll', handleUserActivity);\n      window.removeEventListener('click', handleUserActivity);\n      clearTimeout(inactivityTimerRef.current);\n      clearTimeout(totalSessionTimerRef.current);\n      clearInterval(countdownRef.current);\n    };\n  }, [!!user]);\n\n  // ========================\n  // üîÅ Extender sesi√≥n (bot√≥n \"Mantener sesi√≥n\")\n  // ========================\n  const extendSession = useCallback(() => {\n    console.log('‚úÖ Usuario extendi√≥ la sesi√≥n manualmente');\n\n    // Ocultar modal y resetear countdown\n    setSessionExpiring(false);\n    setCountdown(COUNTDOWN_SECONDS);\n\n    // Limpiar timers de inactividad\n    clearTimeout(inactivityTimerRef.current);\n    clearTimeout(totalSessionTimerRef.current);\n    clearInterval(countdownRef.current);\n\n    // Reiniciar timers desde cero\n    console.log('üîÑ Reiniciando timers de inactividad');\n    inactivityTimerRef.current = setTimeout(() => {\n      console.log('‚è≥ Mostrando aviso de inactividad');\n      setSessionExpiring(true);\n      // Sin conteo visual\n    }, INACTIVITY_WARNING);\n    totalSessionTimerRef.current = setTimeout(async () => {\n      console.log('üö™ Timeout alcanzado despu√©s de extender sesi√≥n');\n      clearInterval(countdownRef.current);\n      setSessionExpiring(false);\n      await logout();\n    }, INACTIVITY_TIMEOUT);\n  }, [INACTIVITY_WARNING, INACTIVITY_TIMEOUT]);\n\n  // ========================\n  // üîê Login\n  // ========================\n  const login = useCallback(async (email, password) => {\n    try {\n      const response = await fetch('http://localhost:5000/api/auth/login', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          email,\n          password\n        })\n      });\n      const data = await response.json();\n      if (response.ok) {\n        var _data$user, _data$user$preference, _data$user2;\n        // Guardar tokens\n        localStorage.setItem('access_token', data.access_token);\n        localStorage.setItem('refresh_token', data.refresh_token);\n        localStorage.setItem('user', JSON.stringify(data.user));\n\n        // Guardar tiempo de expiraci√≥n\n        const expiryTime = Date.now() + ACCESS_TOKEN_LIFETIME;\n        localStorage.setItem('token_expiry', expiryTime.toString());\n        tokenExpiryTimeRef.current = expiryTime;\n        setUser(data.user);\n        // Aplicar tema preferido del usuario si existe, si no la preferencia por-usuario local\n        if ((_data$user = data.user) !== null && _data$user !== void 0 && (_data$user$preference = _data$user.preferences) !== null && _data$user$preference !== void 0 && _data$user$preference.theme) {\n          setTheme(data.user.preferences.theme);\n        } else if ((_data$user2 = data.user) !== null && _data$user2 !== void 0 && _data$user2.id) {\n          const perUser = localStorage.getItem(`app-theme-${data.user.id}`);\n          if (perUser) setTheme(perUser);else setTheme('blue');\n        }\n\n        // Programar refresh proactivo\n        scheduleTokenRefresh();\n        return {\n          success: true,\n          user: data.user\n        };\n      } else {\n        return {\n          success: false,\n          error: data.error || 'Error en el login'\n        };\n      }\n    } catch (error) {\n      return {\n        success: false,\n        error: 'Error de conexi√≥n con el servidor'\n      };\n    }\n  }, [ACCESS_TOKEN_LIFETIME, setTheme]);\n\n  // ========================\n  // üö™ Logout\n  // ========================\n  const logout = useCallback(async () => {\n    try {\n      setSessionExpiring(false);\n\n      // Limpiar todos los timers\n      clearTimeout(refreshTimerRef.current);\n      clearTimeout(inactivityTimerRef.current);\n      clearTimeout(totalSessionTimerRef.current);\n      clearInterval(countdownRef.current);\n      const token = localStorage.getItem('access_token');\n      if (token) {\n        await fetch('http://localhost:5000/api/auth/logout', {\n          method: 'POST',\n          headers: {\n            'Authorization': `Bearer ${token}`\n          }\n        });\n      }\n    } catch (error) {\n      console.error('Error durante logout:', error);\n    } finally {\n      setUser(null);\n      localStorage.removeItem('user');\n      localStorage.removeItem('access_token');\n      localStorage.removeItem('refresh_token');\n      localStorage.removeItem('token_expiry');\n      // Resetear tema general para no arrastrar color entre cuentas\n      try {\n        setTheme('blue');\n        localStorage.setItem('app-theme', 'blue');\n      } catch {}\n      localStorage.setItem('logout_event', Date.now());\n\n      // Resetear refs\n      isRefreshingRef.current = false;\n      refreshPromiseRef.current = null;\n      tokenExpiryTimeRef.current = null;\n\n      // ProtectedRoutes en App.js detectar√° user=null y redirigir√° a /login\n    }\n  }, []);\n\n  // ========================\n  // üîë hasPermission\n  // ========================\n  const hasPermission = useCallback(permission => {\n    if (!user || !user.permissions) return false;\n    return user.permissions.includes(permission);\n  }, [user]);\n\n  // ========================\n  // üåê authFetch con lock anti-race-condition\n  // ========================\n  const authFetch = useCallback(async (url, options = {}) => {\n    let token = localStorage.getItem('access_token');\n    const config = {\n      ...options,\n      headers: {\n        'Content-Type': 'application/json',\n        ...options.headers,\n        'Authorization': `Bearer ${token}`\n      }\n    };\n    let response = await fetch(url, config);\n\n    // Si el token expir√≥ (401), intentar refresh UNA VEZ\n    if (response.status === 401) {\n      console.log('üîÑ Token expirado, intentando refresh...');\n      const refreshed = await refreshToken();\n      if (refreshed) {\n        // Reintentar request con nuevo token\n        token = localStorage.getItem('access_token');\n        config.headers.Authorization = `Bearer ${token}`;\n        response = await fetch(url, config);\n      }\n    }\n    return response;\n  }, []);\n  const contextValue = useMemo(() => ({\n    user,\n    login,\n    logout,\n    hasPermission,\n    loading,\n    authFetch,\n    extendSession\n  }), [user, login, logout, hasPermission, loading, authFetch, extendSession]);\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: contextValue,\n    children: [/*#__PURE__*/_jsxDEV(ChildrenContainer, {\n      children: children\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 535,\n      columnNumber: 7\n    }, this), sessionExpiring && /*#__PURE__*/createPortal(/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[9999]\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"bg-white p-6 rounded-2xl shadow-lg text-center max-w-sm\",\n        children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n          className: \"text-lg font-semibold mb-2 text-gray-800\",\n          children: \"Sesi\\xF3n a punto de expirar\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 541,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"text-gray-600 mb-4\",\n          children: [\"Tu sesi\\xF3n se cerrar\\xE1 autom\\xE1ticamente en \", COUNTDOWN_SECONDS, \" segundos por inactividad.\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 544,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex justify-center gap-4\",\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: extendSession,\n            className: \"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700\",\n            children: \"Mantener sesi\\xF3n\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 548,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: logout,\n            className: \"px-4 py-2 bg-gray-300 text-gray-800 rounded-lg hover:bg-gray-400\",\n            children: \"Cerrar ahora\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 554,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 547,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 540,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 539,\n      columnNumber: 9\n    }, this), document.body)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 534,\n    columnNumber: 5\n  }, this);\n};\n_s2(AuthProvider, \"t6KY3V2uJLmIjuCpxbTiQVxJ9ow=\", false, function () {\n  return [useTheme];\n});\n_c3 = AuthProvider;\nvar _c, _c2, _c3;\n$RefreshReg$(_c, \"ChildrenContainer$React.memo\");\n$RefreshReg$(_c2, \"ChildrenContainer\");\n$RefreshReg$(_c3, \"AuthProvider\");","map":{"version":3,"names":["React","createContext","useContext","useEffect","useState","useRef","useMemo","useCallback","useTheme","createPortal","Fragment","_Fragment","jsxDEV","_jsxDEV","AuthContext","ChildrenContainer","memo","_c","children","_c2","useAuth","_s","AuthProvider","_s2","user","setUser","loading","setLoading","sessionExpiring","setSessionExpiring","setTheme","TIEMPO_CONFIG","TOKEN_DURACION","minutos","segundos","REFRESH_ANTICIPADO","AVISO_INACTIVIDAD","LOGOUT_INACTIVIDAD","aMs","config","ACCESS_TOKEN_LIFETIME","REFRESH_BEFORE_EXPIRY","INACTIVITY_WARNING","INACTIVITY_TIMEOUT","COUNTDOWN_SECONDS","Math","floor","countdown","setCountdown","countdownRef","inactivityTimerRef","totalSessionTimerRef","sessionExpiringRef","refreshTimerRef","isRefreshingRef","refreshPromiseRef","tokenExpiryTimeRef","lastActivityTimeRef","didInitRef","current","window","__profileCache","value","expiry","__profileInFlight","initializeAuth","savedUser","localStorage","getItem","accessToken","_parsed$preferences","parsed","JSON","parse","preferences","theme","id","perUser","tokenExpiry","parseInt","scheduleTokenRefresh","now","Date","cache","_perfil$preferences","perfil","setItem","stringify","response","fetch","method","headers","ok","refreshToken","data","json","_perfil$preferences2","error","console","logout","syncLogout","e","key","removeItem","addEventListener","removeEventListener","clearTimeout","expiryTime","timeUntilExpiry","timeUntilRefresh","log","round","setTimeout","success","access_token","refresh_token","toString","resetInactivityTimers","clearInterval","toLocaleTimeString","handleAutoLogout","startCountdown","handleUserActivity","extendSession","login","email","password","body","_data$user","_data$user$preference","_data$user2","token","hasPermission","permission","permissions","includes","authFetch","url","options","status","refreshed","Authorization","contextValue","Provider","fileName","_jsxFileName","lineNumber","columnNumber","className","onClick","document","_c3","$RefreshReg$"],"sources":["D:/Usuarios/FRANCO/Desktop/parroquav3/frontend/src/contexts/AuthContext.js"],"sourcesContent":["import React, { createContext, useContext, useEffect, useState, useRef, useMemo, useCallback } from 'react';\nimport { useTheme } from './ThemeContext';\nimport { createPortal } from 'react-dom';\n\nconst AuthContext = createContext();\n// Evita re-render de la app cuando el Provider cambia estado interno no relevante\nconst ChildrenContainer = React.memo(({ children }) => <>{children}</>);\n\nexport const useAuth = () => useContext(AuthContext);\n\nexport const AuthProvider = ({ children }) => {\n  const [user, setUser] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const [sessionExpiring, setSessionExpiring] = useState(false);\n  const { setTheme } = useTheme();\n\n  // ‚öôÔ∏è CONFIGURACI√ìN DE TIEMPOS (m√°s legible)\n  // Formato: { minutos: X, segundos: Y }\n  const TIEMPO_CONFIG = {\n  TOKEN_DURACION: { minutos: 1, segundos: 0 },      // Igual que backend\n  REFRESH_ANTICIPADO: { minutos: 0, segundos: 10 }, // 10s antes de expirar\n  AVISO_INACTIVIDAD: { minutos: 0, segundos: 45 },  // Aviso a los 45s\n  LOGOUT_INACTIVIDAD: { minutos: 1, segundos: 0 }   // Logout a 1 min\n};\n\n  // üîß Funci√≥n helper para convertir a milisegundos\n  const aMs = (config) => (config.minutos * 60 + config.segundos) * 1000;\n\n  // Constantes calculadas (NO MODIFICAR)\n  const ACCESS_TOKEN_LIFETIME = aMs(TIEMPO_CONFIG.TOKEN_DURACION);\n  const REFRESH_BEFORE_EXPIRY = aMs(TIEMPO_CONFIG.REFRESH_ANTICIPADO);\n  const INACTIVITY_WARNING = aMs(TIEMPO_CONFIG.AVISO_INACTIVIDAD);\n  const INACTIVITY_TIMEOUT = aMs(TIEMPO_CONFIG.LOGOUT_INACTIVIDAD);\n  const COUNTDOWN_SECONDS = Math.floor((INACTIVITY_TIMEOUT - INACTIVITY_WARNING) / 1000);\n\n  const [countdown, setCountdown] = useState(COUNTDOWN_SECONDS);\n\n  // üîí REFS para control de estado y prevenci√≥n de race conditions\n  const countdownRef = useRef(null);\n  const inactivityTimerRef = useRef(null);\n  const totalSessionTimerRef = useRef(null);\n  const sessionExpiringRef = useRef(sessionExpiring);\n  const refreshTimerRef = useRef(null);\n  const isRefreshingRef = useRef(false);\n  const refreshPromiseRef = useRef(null);\n  const tokenExpiryTimeRef = useRef(null);\n  const lastActivityTimeRef = useRef(0);\n  const didInitRef = useRef(false);\n\n  useEffect(() => {\n    sessionExpiringRef.current = sessionExpiring;\n  }, [sessionExpiring]);\n\n  // ========================\n  // üü¢ Inicializaci√≥n de sesi√≥n (con guardia StrictMode + cache perfil)\n  // ========================\n  useEffect(() => {\n    if (!window.__profileCache) window.__profileCache = { value: null, expiry: 0 };\n    if (!window.__profileInFlight) window.__profileInFlight = null;\n\n    const initializeAuth = async () => {\n      const savedUser = localStorage.getItem('user');\n      const accessToken = localStorage.getItem('access_token');\n\n      if (savedUser && accessToken) {\n        try {\n          const parsed = JSON.parse(savedUser);\n          setUser(parsed);\n          // Aplica tema desde preferencias guardadas del usuario (si existen)\n          if (parsed?.preferences?.theme) {\n            setTheme(parsed.preferences.theme);\n          } else if (parsed?.id) {\n            // Si no hay preferencia en backend, usar la guardada por usuario en local\n            const perUser = localStorage.getItem(`app-theme-${parsed.id}`);\n            if (perUser) setTheme(perUser);\n          }\n        } catch {}\n        \n        // Establecer tiempo de expiraci√≥n del token\n        const tokenExpiry = localStorage.getItem('token_expiry');\n        if (tokenExpiry) {\n          tokenExpiryTimeRef.current = parseInt(tokenExpiry);\n          scheduleTokenRefresh();\n        }\n\n        try {\n          const now = Date.now();\n          const cache = window.__profileCache;\n          if (cache.value && cache.expiry > now) {\n            const perfil = cache.value;\n            setUser(perfil);\n            localStorage.setItem('user', JSON.stringify(perfil));\n            if (perfil?.preferences?.theme) {\n              setTheme(perfil.preferences.theme);\n            } else if (perfil?.id) {\n              const perUser = localStorage.getItem(`app-theme-${perfil.id}`);\n              if (perUser) setTheme(perUser);\n            }\n          } else {\n            if (window.__profileInFlight) {\n              await window.__profileInFlight; // esperar a la petici√≥n en curso\n            } else {\n              window.__profileInFlight = (async () => {\n                const response = await fetch('http://localhost:5000/api/users/profile', {\n                  method: 'GET',\n                  headers: { 'Authorization': `Bearer ${accessToken}` },\n                });\n                if (!response.ok) {\n                  await refreshToken();\n                } else {\n                  const data = await response.json();\n                  const perfil = data?.user || data;\n                  if (perfil) {\n                    window.__profileCache = { value: perfil, expiry: Date.now() + 60000 };\n                  }\n                }\n              })();\n              try { await window.__profileInFlight; } finally { window.__profileInFlight = null; }\n            }\n            // aplicar desde cache si se llen√≥\n            if (window.__profileCache.value) {\n              const perfil = window.__profileCache.value;\n              setUser(perfil);\n              localStorage.setItem('user', JSON.stringify(perfil));\n              if (perfil?.preferences?.theme) {\n                setTheme(perfil.preferences.theme);\n              } else if (perfil?.id) {\n                const perUser = localStorage.getItem(`app-theme-${perfil.id}`);\n                if (perUser) setTheme(perUser);\n              }\n            }\n          }\n        } catch (error) {\n          console.error('Error verificando token:', error);\n          await logout();\n        }\n      }\n      setLoading(false);\n    };\n\n    if (didInitRef.current) return;\n    didInitRef.current = true;\n    initializeAuth();\n  }, []);\n\n  // ========================\n  // üîÅ Sincronizar logout entre pesta√±as\n  // ========================\n  useEffect(() => {\n    const syncLogout = (e) => {\n      if (e.key === 'logout_event') {\n        setUser(null);\n        localStorage.removeItem('user');\n        localStorage.removeItem('access_token');\n        localStorage.removeItem('refresh_token');\n        localStorage.removeItem('token_expiry');\n        // NO usar navigate aqu√≠, ProtectedRoutes lo manejar√°\n      }\n    };\n    window.addEventListener('storage', syncLogout);\n    return () => window.removeEventListener('storage', syncLogout);\n  }, []);\n\n  // ========================\n  // üîÑ REFRESH PROACTIVO (antes de que expire)\n  // ========================\n  const scheduleTokenRefresh = () => {\n    // Limpiar timer anterior\n    if (refreshTimerRef.current) {\n      clearTimeout(refreshTimerRef.current);\n    }\n\n    const expiryTime = tokenExpiryTimeRef.current;\n    if (!expiryTime) return;\n\n    const now = Date.now();\n    const timeUntilExpiry = expiryTime - now;\n    const timeUntilRefresh = timeUntilExpiry - REFRESH_BEFORE_EXPIRY;\n\n    console.log(`üïê Token expira en: ${Math.round(timeUntilExpiry / 1000)}s`);\n    console.log(`üîÑ Programando refresh en: ${Math.round(timeUntilRefresh / 1000)}s`);\n\n    // Solo programar refresh si tiene sentido (token a√∫n v√°lido y no cerca de expirar)\n    if (timeUntilRefresh > 0 && timeUntilExpiry > 0) {\n      refreshTimerRef.current = setTimeout(async () => {\n        console.log('üîÑ Ejecutando refresh proactivo...');\n        const success = await refreshToken();\n        \n        // Si el refresh falla, no programar otro (evita loop infinito)\n        if (!success) {\n          console.log('‚ùå Refresh fall√≥, no se programa otro');\n        }\n      }, timeUntilRefresh);\n    } else if (timeUntilExpiry > 0 && timeUntilExpiry <= REFRESH_BEFORE_EXPIRY) {\n      // Token est√° muy cerca de expirar, refresh inmediato\n      console.log('‚ö†Ô∏è Token muy cerca de expirar, refresh inmediato');\n      refreshToken();\n    } else {\n      // Token ya expir√≥\n      console.log('‚ö†Ô∏è Token ya expir√≥');\n    }\n  };\n\n  // ========================\n  // üîí REFRESH CON LOCK (evita m√∫ltiples llamadas simult√°neas)\n  // ========================\n  const refreshToken = async () => {\n    // Si ya hay un refresh en progreso, esperar a que termine\n    if (isRefreshingRef.current && refreshPromiseRef.current) {\n      console.log('‚è≥ Refresh en progreso, esperando...');\n      return refreshPromiseRef.current;\n    }\n\n    // Marcar que estamos haciendo refresh\n    isRefreshingRef.current = true;\n    \n    refreshPromiseRef.current = (async () => {\n      try {\n        const refreshToken = localStorage.getItem('refresh_token');\n        if (!refreshToken) {\n          console.log('‚ùå No hay refresh token');\n          await logout();\n          return false;\n        }\n\n        console.log('üîÑ Ejecutando refresh token...');\n        const response = await fetch('http://localhost:5000/api/auth/refresh', {\n          method: 'POST',\n          headers: { 'Authorization': `Bearer ${refreshToken}` },\n        });\n\n        const data = await response.json();\n\n        if (response.ok) {\n          console.log('‚úÖ Refresh exitoso');\n          \n          // Guardar nuevos tokens\n          localStorage.setItem('access_token', data.access_token);\n          \n          if (data.refresh_token) {\n            localStorage.setItem('refresh_token', data.refresh_token);\n          }\n          \n          // Calcular y guardar tiempo de expiraci√≥n\n          const expiryTime = Date.now() + ACCESS_TOKEN_LIFETIME;\n          localStorage.setItem('token_expiry', expiryTime.toString());\n          tokenExpiryTimeRef.current = expiryTime;\n          \n          if (data.user) {\n            // Evitar reiniciar timers por cambios de referencia del usuario durante refresh\n            if (!user) {\n              setUser(data.user);\n              localStorage.setItem('user', JSON.stringify(data.user));\n            }\n          }\n\n          // ‚úÖ CR√çTICO: Solo programar pr√≥ximo refresh si NO es un refresh proactivo repetitivo\n          // El pr√≥ximo refresh se programar√° solo cuando sea necesario (por authFetch o nuevo login)\n          console.log('‚úÖ Token renovado, NO se programa refresh autom√°tico adicional');\n          \n          return true;\n        } else {\n          console.log('‚ùå Refresh fall√≥:', data.error);\n          await logout();\n          return false;\n        }\n      } catch (error) {\n        console.error('‚ùå Error en refresh:', error);\n        await logout();\n        return false;\n      } finally {\n        // Liberar el lock\n        isRefreshingRef.current = false;\n        refreshPromiseRef.current = null;\n      }\n    })();\n\n    return refreshPromiseRef.current;\n  };\n\n  // ========================\n  // ‚è∞ Control de inactividad (SEPARADO del refresh de token)\n  // ========================\n  useEffect(() => {\n    if (!user) return;\n\n    const resetInactivityTimers = () => {\n      // NO resetear si el modal ya est√° visible\n      if (sessionExpiringRef.current) return;\n\n      clearTimeout(inactivityTimerRef.current);\n      clearTimeout(totalSessionTimerRef.current);\n      clearInterval(countdownRef.current);\n      setSessionExpiring(false);\n      setCountdown(COUNTDOWN_SECONDS);\n\n      console.log('üîÑ Reset timers de inactividad', new Date().toLocaleTimeString());\n\n      // Timer para mostrar aviso\n      inactivityTimerRef.current = setTimeout(() => {\n        console.log('‚è≥ Mostrando aviso de inactividad');\n        setSessionExpiring(true);\n        // No iniciar conteo visual para evitar re-renders constantes\n      }, INACTIVITY_WARNING);\n\n      // Timer para logout autom√°tico\n      totalSessionTimerRef.current = setTimeout(() => {\n        console.log('üö™ Timeout alcanzado, cerrando sesi√≥n');\n        handleAutoLogout();\n      }, INACTIVITY_TIMEOUT);\n    };\n\n    const startCountdown = () => {\n      // Eliminado conteo visual para evitar re-render de toda la app\n      // El cierre autom√°tico lo maneja totalSessionTimerRef\n      clearInterval(countdownRef.current);\n    };\n\n    const handleAutoLogout = async () => {\n      console.log('üö™ Logout autom√°tico por inactividad');\n      clearInterval(countdownRef.current);\n      setSessionExpiring(false);\n      await logout();\n    };\n\n    const handleUserActivity = () => {\n      // Si el modal est√° visible, NO resetear\n      if (sessionExpiringRef.current) {\n        console.log('‚ö†Ô∏è Modal visible, ignorando actividad');\n        return;\n      }\n      // Throttle de eventos de actividad para evitar r√°fagas (mousemove/scroll)\n      const now = Date.now();\n      if (now - lastActivityTimeRef.current < 1000) return;\n      lastActivityTimeRef.current = now;\n      resetInactivityTimers();\n    };\n\n    // Suscribir eventos de actividad\n    window.addEventListener('mousemove', handleUserActivity);\n    window.addEventListener('keydown', handleUserActivity);\n    window.addEventListener('scroll', handleUserActivity);\n    window.addEventListener('click', handleUserActivity);\n\n    // Inicializar timers\n    resetInactivityTimers();\n\n    return () => {\n      window.removeEventListener('mousemove', handleUserActivity);\n      window.removeEventListener('keydown', handleUserActivity);\n      window.removeEventListener('scroll', handleUserActivity);\n      window.removeEventListener('click', handleUserActivity);\n\n      clearTimeout(inactivityTimerRef.current);\n      clearTimeout(totalSessionTimerRef.current);\n      clearInterval(countdownRef.current);\n    };\n  }, [!!user]);\n\n  // ========================\n  // üîÅ Extender sesi√≥n (bot√≥n \"Mantener sesi√≥n\")\n  // ========================\n  const extendSession = useCallback(() => {\n    console.log('‚úÖ Usuario extendi√≥ la sesi√≥n manualmente');\n    \n    // Ocultar modal y resetear countdown\n    setSessionExpiring(false);\n    setCountdown(COUNTDOWN_SECONDS);\n    \n    // Limpiar timers de inactividad\n    clearTimeout(inactivityTimerRef.current);\n    clearTimeout(totalSessionTimerRef.current);\n    clearInterval(countdownRef.current);\n\n    // Reiniciar timers desde cero\n    console.log('üîÑ Reiniciando timers de inactividad');\n    \n    inactivityTimerRef.current = setTimeout(() => {\n      console.log('‚è≥ Mostrando aviso de inactividad');\n      setSessionExpiring(true);\n      // Sin conteo visual\n    }, INACTIVITY_WARNING);\n\n    totalSessionTimerRef.current = setTimeout(async () => {\n      console.log('üö™ Timeout alcanzado despu√©s de extender sesi√≥n');\n      clearInterval(countdownRef.current);\n      setSessionExpiring(false);\n      await logout();\n    }, INACTIVITY_TIMEOUT);\n  }, [INACTIVITY_WARNING, INACTIVITY_TIMEOUT]);\n\n  // ========================\n  // üîê Login\n  // ========================\n  const login = useCallback(async (email, password) => {\n    try {\n      const response = await fetch('http://localhost:5000/api/auth/login', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ email, password }),\n      });\n\n      const data = await response.json();\n\n      if (response.ok) {\n        // Guardar tokens\n        localStorage.setItem('access_token', data.access_token);\n        localStorage.setItem('refresh_token', data.refresh_token);\n        localStorage.setItem('user', JSON.stringify(data.user));\n        \n        // Guardar tiempo de expiraci√≥n\n        const expiryTime = Date.now() + ACCESS_TOKEN_LIFETIME;\n        localStorage.setItem('token_expiry', expiryTime.toString());\n        tokenExpiryTimeRef.current = expiryTime;\n        \n        setUser(data.user);\n        // Aplicar tema preferido del usuario si existe, si no la preferencia por-usuario local\n        if (data.user?.preferences?.theme) {\n          setTheme(data.user.preferences.theme);\n        } else if (data.user?.id) {\n          const perUser = localStorage.getItem(`app-theme-${data.user.id}`);\n          if (perUser) setTheme(perUser); else setTheme('blue');\n        }\n        \n        // Programar refresh proactivo\n        scheduleTokenRefresh();\n        \n        return { success: true, user: data.user };\n      } else {\n        return { success: false, error: data.error || 'Error en el login' };\n      }\n    } catch (error) {\n      return { success: false, error: 'Error de conexi√≥n con el servidor' };\n    }\n  }, [ACCESS_TOKEN_LIFETIME, setTheme]);\n\n  // ========================\n  // üö™ Logout\n  // ========================\n  const logout = useCallback(async () => {\n    try {\n      setSessionExpiring(false);\n      \n      // Limpiar todos los timers\n      clearTimeout(refreshTimerRef.current);\n      clearTimeout(inactivityTimerRef.current);\n      clearTimeout(totalSessionTimerRef.current);\n      clearInterval(countdownRef.current);\n\n      const token = localStorage.getItem('access_token');\n      if (token) {\n        await fetch('http://localhost:5000/api/auth/logout', {\n          method: 'POST',\n          headers: { 'Authorization': `Bearer ${token}` },\n        });\n      }\n    } catch (error) {\n      console.error('Error durante logout:', error);\n    } finally {\n      setUser(null);\n      localStorage.removeItem('user');\n      localStorage.removeItem('access_token');\n      localStorage.removeItem('refresh_token');\n      localStorage.removeItem('token_expiry');\n      // Resetear tema general para no arrastrar color entre cuentas\n      try {\n        setTheme('blue');\n        localStorage.setItem('app-theme', 'blue');\n      } catch {}\n      localStorage.setItem('logout_event', Date.now());\n      \n      // Resetear refs\n      isRefreshingRef.current = false;\n      refreshPromiseRef.current = null;\n      tokenExpiryTimeRef.current = null;\n      \n      // ProtectedRoutes en App.js detectar√° user=null y redirigir√° a /login\n    }\n  }, []);\n\n  // ========================\n  // üîë hasPermission\n  // ========================\n  const hasPermission = useCallback((permission) => {\n    if (!user || !user.permissions) return false;\n    return user.permissions.includes(permission);\n  }, [user]);\n\n  // ========================\n  // üåê authFetch con lock anti-race-condition\n  // ========================\n  const authFetch = useCallback(async (url, options = {}) => {\n    let token = localStorage.getItem('access_token');\n\n    const config = {\n      ...options,\n      headers: {\n        'Content-Type': 'application/json',\n        ...options.headers,\n        'Authorization': `Bearer ${token}`,\n      },\n    };\n\n    let response = await fetch(url, config);\n\n    // Si el token expir√≥ (401), intentar refresh UNA VEZ\n    if (response.status === 401) {\n      console.log('üîÑ Token expirado, intentando refresh...');\n      \n      const refreshed = await refreshToken();\n      \n      if (refreshed) {\n        // Reintentar request con nuevo token\n        token = localStorage.getItem('access_token');\n        config.headers.Authorization = `Bearer ${token}`;\n        response = await fetch(url, config);\n      }\n    }\n\n    return response;\n  }, []);\n\n  const contextValue = useMemo(() => ({\n    user,\n    login,\n    logout,\n    hasPermission,\n    loading,\n    authFetch,\n    extendSession\n  }), [user, login, logout, hasPermission, loading, authFetch, extendSession]);\n\n  return (\n    <AuthContext.Provider value={contextValue}>\n      <ChildrenContainer>{children}</ChildrenContainer>\n\n      {/* üîî Modal de inactividad en Portal para aislar del √°rbol principal */}\n      {sessionExpiring && createPortal(\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[9999]\">\n          <div className=\"bg-white p-6 rounded-2xl shadow-lg text-center max-w-sm\">\n            <h2 className=\"text-lg font-semibold mb-2 text-gray-800\">\n              Sesi√≥n a punto de expirar\n            </h2>\n            <p className=\"text-gray-600 mb-4\">\n              Tu sesi√≥n se cerrar√° autom√°ticamente en {COUNTDOWN_SECONDS} segundos por inactividad.\n            </p>\n            <div className=\"flex justify-center gap-4\">\n              <button\n                onClick={extendSession}\n                className=\"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700\"\n              >\n                Mantener sesi√≥n\n              </button>\n              <button\n                onClick={logout}\n                className=\"px-4 py-2 bg-gray-300 text-gray-800 rounded-lg hover:bg-gray-400\"\n              >\n                Cerrar ahora\n              </button>\n            </div>\n          </div>\n        </div>,\n        document.body\n      )}\n    </AuthContext.Provider>\n  );\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}