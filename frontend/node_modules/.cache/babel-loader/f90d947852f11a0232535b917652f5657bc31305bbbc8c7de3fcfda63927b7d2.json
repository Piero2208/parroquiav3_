{"ast":null,"code":"var _s = $RefreshSig$();\n// src/hooks/useCatalogoPermisos.js\nimport { useEffect, useMemo, useRef, useState } from 'react';\nimport { useAuth } from '../contexts/AuthContext';\nimport { PERMISOS as PERMISOS_LOCAL, ETIQUETAS_PERMISOS } from '../constants/permissions';\n\n// Hook en espa침ol para obtener y normalizar el cat치logo de permisos\n// Devuelve: { ids, etiquetas, loading, error, refrescar }\nexport default function useCatalogoPermisos() {\n  _s();\n  const {\n    authFetch\n  } = useAuth();\n  const [ids, setIds] = useState(PERMISOS_LOCAL);\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState('');\n  const didRun = useRef(false);\n  if (!window.__permCache) {\n    window.__permCache = {\n      value: null,\n      expiry: 0\n    };\n  }\n  useEffect(() => {\n    let cancelado = false;\n    const now = Date.now();\n    const fromCache = window.__permCache;\n    if (fromCache.value && fromCache.expiry > now) {\n      setIds(fromCache.value);\n    }\n    if (didRun.current) return () => {\n      cancelado = true;\n    };\n    didRun.current = true;\n    const cargar = async () => {\n      try {\n        setLoading(true);\n        setError('');\n        const resp = await authFetch('http://localhost:5000/api/permissions');\n        if (!resp.ok) return;\n        const data = await resp.json();\n        if (!cancelado && Array.isArray(data.permissions)) {\n          const norm = data.permissions.map(p => typeof p === 'string' ? p : p && (p.id || p.name) || '').filter(Boolean);\n          window.__permCache = {\n            value: norm,\n            expiry: now + 60000\n          };\n          setIds(norm);\n        }\n      } catch (e) {} finally {\n        if (!cancelado) setLoading(false);\n      }\n    };\n    if (!fromCache.value || fromCache.expiry <= now) cargar();\n    return () => {\n      cancelado = true;\n    };\n  }, [authFetch]);\n  const etiquetas = useMemo(() => {\n    const map = {};\n    ids.forEach(id => {\n      map[id] = ETIQUETAS_PERMISOS[id] || id;\n    });\n    return map;\n  }, [ids]);\n  const refrescar = async () => {\n    try {\n      setLoading(true);\n      setError('');\n      const resp = await authFetch('http://localhost:5000/api/permissions');\n      if (!resp.ok) return {\n        success: false\n      };\n      const data = await resp.json();\n      if (Array.isArray(data.permissions)) {\n        const norm = data.permissions.map(p => typeof p === 'string' ? p : p && (p.id || p.name) || '').filter(Boolean);\n        window.__permCache = {\n          value: norm,\n          expiry: Date.now() + 60000\n        };\n        setIds(norm);\n      }\n      return {\n        success: true\n      };\n    } catch (e) {\n      setError(e.message || 'Error cargando permisos');\n      return {\n        success: false,\n        error: e.message\n      };\n    } finally {\n      setLoading(false);\n    }\n  };\n  return {\n    ids,\n    etiquetas,\n    loading,\n    error,\n    refrescar\n  };\n}\n_s(useCatalogoPermisos, \"bNviyWKcvb60oXpYq4jsicW8Sxo=\", false, function () {\n  return [useAuth];\n});","map":{"version":3,"names":["useEffect","useMemo","useRef","useState","useAuth","PERMISOS","PERMISOS_LOCAL","ETIQUETAS_PERMISOS","useCatalogoPermisos","_s","authFetch","ids","setIds","loading","setLoading","error","setError","didRun","window","__permCache","value","expiry","cancelado","now","Date","fromCache","current","cargar","resp","ok","data","json","Array","isArray","permissions","norm","map","p","id","name","filter","Boolean","e","etiquetas","forEach","refrescar","success","message"],"sources":["D:/Usuarios/FRANCO/Desktop/parroquav3/frontend/src/hooks/useCatalogoPermisos.js"],"sourcesContent":["// src/hooks/useCatalogoPermisos.js\nimport { useEffect, useMemo, useRef, useState } from 'react';\nimport { useAuth } from '../contexts/AuthContext';\nimport { PERMISOS as PERMISOS_LOCAL, ETIQUETAS_PERMISOS } from '../constants/permissions';\n\n// Hook en espa침ol para obtener y normalizar el cat치logo de permisos\n// Devuelve: { ids, etiquetas, loading, error, refrescar }\nexport default function useCatalogoPermisos() {\n  const { authFetch } = useAuth();\n  const [ids, setIds] = useState(PERMISOS_LOCAL);\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState('');\n  const didRun = useRef(false);\n\n  if (!window.__permCache) {\n    window.__permCache = { value: null, expiry: 0 };\n  }\n\n  useEffect(() => {\n    let cancelado = false;\n    const now = Date.now();\n    const fromCache = window.__permCache;\n    if (fromCache.value && fromCache.expiry > now) {\n      setIds(fromCache.value);\n    }\n    if (didRun.current) return () => { cancelado = true; };\n    didRun.current = true;\n    const cargar = async () => {\n      try {\n        setLoading(true);\n        setError('');\n        const resp = await authFetch('http://localhost:5000/api/permissions');\n        if (!resp.ok) return;\n        const data = await resp.json();\n        if (!cancelado && Array.isArray(data.permissions)) {\n          const norm = data.permissions\n            .map((p) => (typeof p === 'string' ? p : (p && (p.id || p.name)) || ''))\n            .filter(Boolean);\n          window.__permCache = { value: norm, expiry: now + 60000 };\n          setIds(norm);\n        }\n      } catch (e) {\n      } finally {\n        if (!cancelado) setLoading(false);\n      }\n    };\n    if (!fromCache.value || fromCache.expiry <= now) cargar();\n    return () => { cancelado = true; };\n  }, [authFetch]);\n\n  const etiquetas = useMemo(() => {\n    const map = {};\n    ids.forEach((id) => { map[id] = ETIQUETAS_PERMISOS[id] || id; });\n    return map;\n  }, [ids]);\n\n  const refrescar = async () => {\n    try {\n      setLoading(true);\n      setError('');\n      const resp = await authFetch('http://localhost:5000/api/permissions');\n      if (!resp.ok) return { success: false };\n      const data = await resp.json();\n      if (Array.isArray(data.permissions)) {\n        const norm = data.permissions\n          .map((p) => (typeof p === 'string' ? p : (p && (p.id || p.name)) || ''))\n          .filter(Boolean);\n        window.__permCache = { value: norm, expiry: Date.now() + 60000 };\n        setIds(norm);\n      }\n      return { success: true };\n    } catch (e) {\n      setError(e.message || 'Error cargando permisos');\n      return { success: false, error: e.message };\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return { ids, etiquetas, loading, error, refrescar };\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}